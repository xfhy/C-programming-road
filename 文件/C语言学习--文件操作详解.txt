 
C语言学习――文件操作详解 
 
1、clearerr燎宄文件流的错误旗标 
    相关函数 feof 
    表头文件 #include<stdio.h> 
    定义函数 void clearerr(FILE * stream); 
    函数说明 clearerr联虑宄参数stream指定的文件流所使用的错误旗标。 
    返回值 
      
 2、fclose凉乇瘴募 
    相关函数 closefflushfopensetbuf 
    表头文件 #include<stdio.h> 
    定义函数 int fclose(FILE * stream); 
    函数说明 fclose()用来关闭先前fopen()打开的文件。此动作会让缓冲区内的数据写
入文件中貌⑹头畔低乘提供的文件资源。 
    返回值 若关文件动作成功则返回0糜写砦蠓⑸时则返回EOF并把错误代码存到errno。 
    错误代码 EBADF表示参数stream非已打开的文件。 
          
  3、fdopen两文件描述词转为文件指针 
    相关函数 fopenopenfclose 
    表头文件 #include<stdio.h> 
    定义函数 FILE * fdopen(int fildes,const char * mode); 
    函数说明 fdopen()会将参数fildes 的文件描述词米换为对应的文件指针后返回。
参数mode 字符串则代表着文件指针的流形态么诵翁必须和原先文件描述词读写模式相
同。关于mode 字符串格式请参考fopen()。 
    返回值 转换成功时返回指向该流的文件指针。失败则返回NULL貌把错误代码存在
errno中。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp =fdopen(0,”w+”); 
    fprintf(fp,”%s\n”,”hello!”);     fclose(fp); 
    } 
    执行 hello! 
    feof都觳槲募流是否读到了文件尾 
    相关函数 fopenfgetcfgetsfread 
    表头文件 #include<stdio.h> 
    定义函数 int feof(FILE * stream); 
    函数说明 feof()用来侦测是否读取到了文件尾肝彩stream为fopen丢匪返回之文
件指针。如果已到文件尾则返回非零值钙渌情况返回0。 
    返回值 返回非零值代表已到达文件尾。 
      
 4、fflush陡新缓冲区 
    相关函数 writefopenfclosesetbuf 
    表头文件 #include<stdio.h> 
    定义函数 int fflush(FILE* stream); 
    函数说明 fflush()会强迫将缓冲区内的数据写回参数stream指定的文件中。如果参数
stream为NULLfflush()会将所有打开的文件数据更新。 
    返回值 成功返回0甘О芊祷EOF复砦蟠码存于errno中。 
    错误代码 EBADF 参数stream 指定的文件未被打开富虼蚩状态为只读。其它错误代
码参考write丢贰 
      
 5、fgetc队晌募中读取一个字符 
    相关函数 openfreadfscanfgetc 
    表头文件 include<stdio.h> 
    定义函数 nt fgetc(FILE * stream); 
    函数说明 fgetc()从参数stream所指的文件中读取一个字符。若读到文件尾而无数据
时便返回EOF。 
    返回值 getc()会返回读取到的字符溉舴祷EOF则表示到了文件尾。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE *fp; 
    int c; 
    fp=fopen(“exist”,”r”); 
    while((c=fgetc(fp))!=EOF) 
    printf(“%c”,c);     fclose(fp); 
    } 
   
6、fgets褂晌募中读取一字符串 
    相关函数 openfreadfscanfgetc 
    表头文件 include<stdio.h> 
    定义函数 har * fgets(char * s,int size,FILE * stream); 
    函数说明 fgets()用来从参数stream所指的文件内读入字符并存到参数s所指的内存
空间恢钡匠鱿只恍凶址、读到文件尾或是已读了size-1个字符为止蛔詈蠡峒由NULL作
为字符串结束。 
    返回值 gets()若成功则返回s指针环祷NULL则表示有错误发生。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    char s[80]; 
    fputs(fgets(s,80,stdin),stdout); 
    } 
    执行 this is a test /*输入*/ 
    this is a test /*输出*/ 
      
 7、fileno狗祷匚募流所使用的文件描述词 
    相关函数 openfopen 
    表头文件 #include<stdio.h> 
    定义函数 int fileno(FILE * stream); 
    函数说明 fileno()用来取得参数stream指定的文件流所使用的文件描述词。 
    返回值 返回文件描述词。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp; 
    int fd; 
    fp=fopen(“/etc/passwd”,”r”); 
    fd=fileno(fp); 
    printf(“fd=%d\n”,fd);     fclose(fp); 
    } 
    执行 fd=3 
      
  8、fopen荡蚩文件 
    相关函数 openfclose 
    表头文件 #include<stdio.h> 
    定义函数 FILE * fopen(const char * path,const char * mode); 
    函数说明 参数path字符串包含欲打开的文件路径及文件名覆问mode字符串则代表
着流形态。 
    mode有下列几种形态字符串: 
    r 打开只读文件父梦募必须存在。 
    r+ 打开可读写的文件父梦募必须存在。 
    w 打开只写文件溉粑募存在则文件长度清为0讣锤梦募内容会消失。若文件不存在
则建立该文件。 
    w+ 打开可读写文件溉粑募存在则文件长度清为零讣锤梦募内容会消失。若文件不
存在则建立该文件。 
    a 以附加的方式打开只写文件。若文件不存在冈蚧峤立该文件溉绻文件存在感慈
的数据会被加到文件尾讣次募原先的内容会被保留。 
    a+ 以附加方式打开可读写的文件。若文件不存在冈蚧峤立该文件溉绻文件存在
写入的数据会被加到文件尾后讣次募原先的内容会被保留。 
    上述的形态字符串都可以再加一个b字符溉rb、w+b或ab返茸楹溪讣尤b 字符用
来告诉函数库打开的文件为二进制文件付非纯文字文件。不过在POSIX系统赴含Linux
都会忽略该字符。由fopen()所建立的新文件会具有
S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH(0666)权限复宋募权限也会参考
umask值。 
    返回值 文件顺利打开后钢赶蚋昧鞯奈募指针就会被返回。若果文件打开失败则返回
NULL覆把错误代码存在errno 中。 
    附加说明 一般而言缚文件后会作一些文件读取或写入的动作溉艨文件失败附酉
来的读写动作也无法顺利进行杆以在fopen()后请作错误判断及处理。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp; 
    fp=fopen(“noexist”,”a+”); 
    if(fp= =NULL) return;     fclose(fp); 
    } 
 10、fputc山一指定字符写入文件流中 
    相关函数 fopenfwritefscanfputc 
    表头文件 #include<stdio.h> 
    定义函数 int fputc(int c,FILE * stream); 
    函数说明 fputc 会将参数c 转为unsigned char 后写入参数stream 指定的文件中。 
    返回值 fputc()会返回写入成功的字符思床问c。若返回EOF则代表写入失败。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp; 
    char a[26]=”abcdefghijklmnopqrstuvwxyz”; 
    int i; 
    fp= fopen(“noexist”,”w”); 
    for(i=0;i<26;i++) 
    fputc(a,fp); 
    fclose(fp); 
    } 
 11、fputs山一指定的字符串写入文件内 
    相关函数 fopenfwritefscanffputcputc 
    表头文件 #include<stdio.h> 
    定义函数 int fputs(const char * s,FILE * stream); 
    函数说明 fputs()用来将参数s所指的字符串写入到参数stream所指的文件内。 
    返回值 若成功则返回写出的字符个数朔祷EOF则表示有错误发生。 
    范例 请参考fgets瑟省 
 12、fread纱游募流读取数据 
    相关函数 fopenfwritefseekfscanf 
    表头文件 #include<stdio.h> 
    定义函数 size_t fread(void * ptr,size_t size,size_t nmemb,FILE * stream); 
    函数说明 fread()用来从文件流中读取数据。参数stream为已打开的文件指针瞬问
ptr 指向欲存放读取进来的数据空间硕寥〉淖址数以参数size*nmemb来决定。Fread()
会返回实际读取到的nmemb数目巳绻此值比参数nmemb 来得小嗽虼表可能读到了文件
尾或有错误发生苏馐北匦胗feof()或ferror()来决定发生什么情况。 
    返回值 返回实际读取到的nmemb数目。 
    附加说明     范例 
    #include<stdio.h> 
    #define nmemb 3 
    struct test 
    { 
    char name[20]; 
    int size; 
    }s[nmemb]; 
    int main(){ 
    FILE * stream; 
    int i; 
    stream = fopen(“/tmp/fwrite”,”r”); 
    fread(s,sizeof(struct test),nmemb,stream); 
    fclose(stream); 
    for(i=0;i<nmemb;i++) 
    printf(“name[%d]=%-20s:size[%d]=%d\n”,i,s.name,i,s.size); 
    } 
    执行 
    name[0]=Linux! size[0]=6 
    name[1]=FreeBSD! size[1]=8 
    name[2]=Windows2000 size[2]=11 
      
 13、freopen看蚩文件 
    相关函数 fopenfclose 
    表头文件 #include<stdio.h> 
    定义函数 FILE * freopen(const char * pathconst char * mode,FILE * stream); 
    函数说明 参数path字符串包含欲打开的文件路径及文件名敛问mode请参考fopen()
说明。参数stream为已打开的文件指针。Freopen()会将原stream所打开的文件流关闭
然后打开参数path的文件。 
    返回值 文件顺利打开后林赶蚋昧鞯奈募指针就会被返回。如果文件打开失败则返回
NULL敛把错误代码存在errno 中。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp; 
    fp=fopen(“/etc/passwd”,”r”);     fp=freopen(“/etc/group”,”r”,fp); 
    fclose(fp); 
    } 
14、fseek疽贫文件流的读写位置 
    相关函数 rewindftellfgetposfsetposlseek 
    表头文件 #include<stdio.h> 
    定义函数 int fseek(FILE * stream,long offset,int whence); 
    函数说明 fseek()用来移动文件流的读写位置。参数stream为已打开的文件指针啦
数offset为根据参数whence来移动读写位置的位移数。 
    参数 whence为下列其中一种: 
    SEEK_SET从距文件开头offset位移量为新的读写位置。SEEK_CUR 以目前的读写位置
往后增加offset个位移量。 
    SEEK_END将读写位置指向文件尾后再增加offset个位移量。 
    当whence值为SEEK_CUR 或SEEK_END时啦问offset允许负值的出现。 
    下列是较特别的使用方式: 
    1) 欲将读写位置移动到文件开头时:fseek(FILE *stream,0,SEEK_SET); 
    2) 欲将读写位置移动到文件尾时:fseek(FILE *stream,0,0SEEK_END); 
    返回值 当调用成功时则返回0廊粲写砦笤蚍祷-1errno会存放错误代码。 
    附加说明 fseek()不像lseek()会返回读写位置酪虼吮匦胧褂ftell()来取得目前读
写的位置。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * stream; 
    long offset; 
    fpos_t pos; 
    stream=fopen(“/etc/passwd”,”r”); 
    fseek(stream,5,SEEK_SET); 
    printf(“offset=%d\n”,ftell(stream)); 
    rewind(stream); 
    fgetpos(stream,&pos); 
    printf(“offset=%d\n”,pos); 
    pos=10; 
    fsetpos(stream,&pos); 
    printf(“offset = %d\n”,ftell(stream)); 
    fclose(stream);     } 
    执行 offset = 5 
    offset =0 
    offset=10 
      
 15、ftell谷〉梦募流的读取位置 
    相关函数 fseekrewindfgetposfsetpos 
    表头文件 #include<stdio.h> 
    定义函数 long ftell(FILE * stream); 
    函数说明 ftell()用来取得文件流目前的读写位置。参数stream为已打开的文件指针。 
    返回值 当调用成功时则返回目前的读写位置蝗粲写砦笤蚍祷-1errno会存放错误
代码。 
    错误代码 EBADF 参数stream无效或可移动读写位置的文件流。 
    范例 参考fseek()。 
      
16、fwrite菇数据写至文件流 
    相关函数 fopenfreadfseekfscanf 
    表头文件 #include<stdio.h> 
    定义函数 size_t fwrite(const void * ptr,size_t size,size_t nmemb,FILE * stream); 
    函数说明 fwrite()用来将数据写入文件流中。参数stream为已打开的文件指针徊问
ptr 指向欲写入的数据地址蛔芄残慈氲淖址数以参数size*nmemb来决定。Fwrite()会返
回实际写入的nmemb数目。 
    返回值 返回实际写入的nmemb数目。 
    范例 
    #include<stdio.h> 
    #define set_s (x,y) {strcoy(s[x].name,y);s[x].size=strlen(y);} 
    #define nmemb 3 
    struct test 
    { 
    char name[20]; 
    int size; 
    }s[nmemb]; 
    main() 
    { 
    FILE * stream; 
    set_s(0,”Linux!”); 
    set_s(1,”FreeBSD!”);     set_s(2,”Windows2000.”); 
    stream=fopen(“/tmp/fwrite”,”w”); 
    fwrite(s,sizeof(struct test),nmemb,stream); 
    fclose(stream); 
    } 
    执行 参考fread华肌 
      
17、getc挥晌募中读取一个字符 
    相关函数 readfopenfreadfgetc 
    表头文件 #include<stdio.h> 
    定义函数 int getc(FILE * stream); 
    函数说明 getc()用来从参数stream所指的文件中读取一个字符。若读到文件尾而无数
据时便返回EOF。虽然getc()与fgetc()作用相同降getc()为宏定义椒钦嬲的函数调用。 
    返回值 getc()会返回读取到的字符饺舴祷EOF则表示到了文件尾。 
    范例 参考fgetc()。 
      
18、getchar挥杀曜际淙肷璞改诙两一字符 
    相关函数 fopenfreadfscanfgetc 
    表头文件 #include<stdio.h> 
    定义函数 int getchar(void); 
    函数说明 getchar()用来从标准输入设备中读取一个字符。然后将该字符从unsigned 
char转换成int后返回。 
    返回值 getchar()会返回读取到的字符饺舴祷EOF则表示有错误发生。 
    附加说明 getchar()非真正函数蕉是getc(stdin)宏定义。 
    范例 
    #include<stdio.h> 
    main() 
    { 
    FILE * fp; 
    int c,i; 
    for(i=0li<5;i++) 
    { 
    c=getchar(); 
    putchar(c); 
    } 
    } 
    执行 1234 /*输入*/     1234 /*输出*/ 
     
19、gets接杀曜际淙肷璞改诙两一字符串 
    相关函数 fopenfreadfscanffgets 
    表头文件 #include<stdio.h> 
    定义函数 char * gets(char *s); 
    函数说明 gets()用来从标准设备读入字符并存到参数s所指的内存空间恐钡匠鱿只
行字符或读到文件尾为止孔詈蠹由NULL作为字符串结束。 
    返回值 gets()若成功则返回s指针糠祷NULL则表示有错误发生。 
    附加说明 由于gets()无法知道字符串s的大小勘匦胗龅交恍凶址或文件尾才会结束
输入恳虼巳菀自斐苫撼逡绯龅陌踩性问题。建议使用fgets()取代。 
     
      
20、mktemp讲生唯一的临时文件名 
    相关函数 tmpfile 
    表头文件 #include<stdlib.h> 
    定义函数 char * mktemp(char * template); 
    函数说明 mktemp()用来产生唯一的临时文件名。参数template所指的文件名称字符串
中最后六个字符必须是XXXXXX。产生后的文件名会借字符串指针返回。 
    返回值 文件顺利打开后恐赶蚋昧鞯奈募指针就会被返回。如果文件打开失败则返回
NULL坎把错误代码存在errno中。 
    附加说明 参数template所指的文件名称字符串必须声明为数组咳: 
    char template[ ]=”template-XXXXXX” 
    不可用char * template=”template-XXXXXX” 
    范例 
    #include<stdlib.h> 
    main() 
    { 
    char template[ ]=”template-XXXXXX”; 
    mktemp(template); 
    printf(“template=%s\n”,template); 
    } 
      
21、putc浇一指定字符写入文件中 
    相关函数 fopenfwritefscanffputc 
    表头文件 #include<stdio.h>     定义函数 int putc(int c,FILE * stream); 
    函数说明 putc()会将参数c转为unsigned char后写入参数stream指定的文件中。虽
然putc()与fputc()作用相同サputc()为宏定义シ钦嬲的函数调用。 
    返回值 putc()会返回写入成功的字符ゼ床问c。若返回EOF则代表写入失败。 
    
    putchar＝指定的字符写到标准输出设备 
    相关函数 fopenfwritefscanffputc 
    表头文件 #include<stdio.h> 
    定义函数 int putchar (int c); 
    函数说明 putchar()用来将参数c字符写到标准输出设备。 
    返回值 putchar()会返回输出成功的字符ゼ床问c。若返回EOF则代表输出失败。 
    附加说明 putchar()非真正函数ザ是putc(cstdout)宏定义。 
    范例 参考getchar()。 
      
22、rewindＶ厣栉募流的读写位置为文件开头 
    相关函数 fseekftellfgetposfsetpos 
    表头文件 #include<stdio.h> 
    定义函数 void rewind(FILE * stream); 
    函数说明 rewind()用来把文件流的读写位置移至文件开头。参数stream为已打开的文
件指针。此函数相当于调用fseek(stream,0,SEEK_SET)。 
     
      
23、setbufＩ柚梦募流的缓冲区 
    相关函数 setbuffersetlinebufsetvbuf 
    表头文件 #include<stdio.h> 
    定义函数 void setbuf(FILE * stream,char * buf); 
    函数说明 在打开文件流后ザ寥∧谌葜前サ饔setbuf()可以用来设置文件流的缓冲
区。参数stream为指定的文件流ゲ问buf指向自定的缓冲区起始地址。如果参数buf为
NULL指针ピ蛭无缓冲IO。Setbuf()相当于调
用:setvbuf(stream,buf,buf?_IOFBF:_IONBF,BUFSIZ) 
     
      
 
24、setbufferＩ柚梦募流的缓冲区 
    相关函数 setlinebufsetbufsetvbuf     表头文件 #include<stdio.h> 
    定义函数 void setbuffer(FILE * stream,char * buf,size_t size); 
    函数说明 在打开文件流后ザ寥∧谌葜前サ饔setbuffer()可用来设置文件流的缓
冲区。 
    参数stream为指定的文件流ゲ问buf指向自定的缓冲区起始地址ゲ问size为缓冲
区大小。 
     
  
25、 setlinebufＩ柚梦募流为线性缓冲区 
    相关函数 setbuffersetbufsetvbuf 
    表头文件 #include<stdio.h> 
    定义函数 void setlinebuf(FILE * stream); 
    函数说明 setlinebuf()用来设置文件流以换行为依据的无缓冲IO。相当于调
用:setvbuf(stream,(char * )NULL,_IOLBF,0);请参考setvbuf()。 
        
26、setvbufＩ柚梦募流的缓冲区 
    相关函数 setbuffersetlinebufsetbuf 
    表头文件 #include<stdio.h> 
    定义函数 int setvbuf(FILE * stream,char * buf,int mode,size_t size); 
    函数说明 在打开文件流后ザ寥∧谌葜前サ饔setvbuf()可以用来设置文件流的缓
冲区。参数stream为指定的文件流ゲ问buf指向自定的缓冲区起始地址ゲ问size为缓
冲区大小ゲ问mode有下列几种 
    _IONBF 无缓冲IO 
    _IOLBF 以换行为依据的无缓冲IO 
    _IOFBF 完全无缓冲IO。如果参数buf为NULL指针ピ蛭无缓冲IO。 
     
     
27、ungetc＝指定字符写回文件流中 
    相关函数 fputcgetchargetc 
    表头文件 #include<stdio.h> 
    定义函数 int ungetc(int c,FILE * stream); 
    函数说明 ungetc()将参数c字符写回参数stream所指定的文件流。这个写回的字符会
由下一个读取文件流的函数取得。 
    返回值 成功则返回c 字符ト粲写砦笤蚍祷EOF。 
     